define(["jwplayer","core/config","core/yui","core/log"],function(a,b,c,d){var e=null,f=function(a){var f=this,g={method:"POST",data:{sesskey:b.sesskey,event:JSON.stringify(a),id:e,title:f.getPlaylistItem().title,file:f.getPlaylistItem().file,position:f.getPosition(),bitrate:f.getCurrentQuality().bitrate},on:{failure:function(a){d.error(a)}}};"play"==a.type&&setTimeout(function(){g.data.position=f.getPosition()},10),"levelsChanged"==a.type&&(g.data.qualitylevel=JSON.stringify(f.getQualityLevels())),"audioTrackChanged"==a.type&&(g.data.audiotracks=JSON.stringify(f.getAudioTracks())),"captionsChanged"==a.type&&(g.data.captions=JSON.stringify(f.getCaptionsList())),c.io(b.wwwroot+"/filter/jwplayer/eventlogger.php",g)},g=function(a){var b=this.getPlaylistItem().title+" "+a.type+": "+a.message;d.error(b)};return{init:function(b){window.jwplayer=window.jwplayer||a,b&&(window.jwplayer.key=b)},setupPlayer:function(b){e=b.logcontext;var c=a(b.playerid);c.setup(b.setupdata),"undefined"!=typeof b.downloadbtn&&c.addButton(b.downloadbtn.img,b.downloadbtn.tttext,function(){window.location.href=c.getPlaylistItem().file+"?forcedownload=true"},"download"),c.on("setupError",g),c.on("error",g),b.logevents.forEach(function(a){c.on(a,f)})}}});